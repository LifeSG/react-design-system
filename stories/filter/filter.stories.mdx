import { MagnifierIcon } from "@lifesg/react-icons/magnifier";
import { Canvas, Meta, Preview, Story } from "@storybook/addon-docs";
import { useState } from "react";
import { Filter } from "../../src/filter";
import { Form } from "../../src/form";
import { Overlay } from "../../src/overlay";
import { Heading3, Secondary, Title } from "../storybook-common";
import { Wrapper, CheckboxFilter, SearchFilter } from "./doc-elements.tsx";

<Meta title="Modules/Filter" component={Filter} />

<Title>Filter</Title>

<Secondary>Overview</Secondary>

Filter description

```tsx
import { Filter } from "@lifesg/react-design-system/filter";
```

<Canvas>
    <Story name="Filter">
        {() => {
            const [currentFilters, setCurrentFilters] = useState({
                search: "",
                cat1: {},
            });
            const [draftFilters, setDraftFilters] = useState(currentFilters);
            const clearButtonDisabled = Object.entries(currentFilters).every(
                (filter) => !filter
            );
            const updateFilter = (mode, filterKey) => (val) => {
                if (mode === "default") {
                    setCurrentFilters((filters) => ({
                        ...filters,
                        [filterKey]: val,
                    }));
                }
                setDraftFilters((filters) => {
                    return {
                        ...filters,
                        [filterKey]: val,
                    };
                });
            };
            const saveFilters = () => {
                setCurrentFilters(draftFilters);
            };
            console.log(currentFilters);
            return (
                <div style={{ maxWidth: "500px", width: "100vw" }}>
                    <Filter
                        clearButtonDisabled={clearButtonDisabled}
                        onDone={saveFilters}
                        items={[
                            {
                                collapsible: false,
                                allowFullscreen: true,
                                render: (mode) => {
                                    return (
                                        <SearchFilter
                                            mode={mode}
                                            value={draftFilters.search}
                                            onChange={updateFilter(
                                                mode,
                                                "search"
                                            )}
                                        />
                                    );
                                },
                            },
                            {
                                title: "Category 1",
                                render: (mode) => {
                                    return (
                                        <CheckboxFilter
                                            mode={mode}
                                            value={draftFilters.cat1}
                                            onChange={updateFilter(
                                                mode,
                                                "cat1"
                                            )}
                                        />
                                    );
                                },
                            },
                        ]}
                    />
                </div>
            );
        }}
    </Story>
</Canvas>

<Heading3>Configuring behaviour</Heading3>

You may configure the behaviour of each section with the `collapsible` and `allowFullscreen` props.

<Canvas>
    <Story name="Configuring behaviour">
        {() => {
            return (
                <div style={{ maxWidth: "500px", width: "100vw" }}>
                    <Filter
                        items={[
                            {
                                title: "Default",
                                render: () => {
                                    return <>Collapsible</>;
                                },
                            },
                            {
                                render: () => {
                                    return <>No title, collapsible</>;
                                },
                            },
                            {
                                collapsible: false,
                                render: () => {
                                    return <>No title, not collapsible</>;
                                },
                            },
                            {
                                title: "Switch to fullscreen",
                                allowFullscreen: true,
                                render: (mode) => {
                                    if (mode === "fullscreen") {
                                        return "Fullscreen mode";
                                    } else if (mode === "mobile") {
                                        return "Click to toggle fullscreen mode";
                                    } else {
                                        return "Switch to a mobile viewport to test fullscreen behaviour";
                                    }
                                },
                            },
                            {
                                title: "Title",
                                collapsible: false,
                                render: () => {
                                    return <>Not collapsible</>;
                                },
                            },
                        ]}
                    />
                </div>
            );
        }}
    </Story>
</Canvas>

<Heading3>Floating content</Heading3>

If some child elements are positioned absolutely, content may be clipped if they exceed the parent's boundaries.
For such scenarios, you may increase the height of the container by adding some padding.

In the example below, extra padding is applied when the dropdown list is expanded.

<Canvas>
    <Story name="With floating content">
        {() => {
            const [showOptions, setShowOptions] = useState(false);
            return (
                <div style={{ maxWidth: "500px", width: "100vw" }}>
                    <Filter
                        items={[
                            {
                                title: "Category 1",
                                render: () => {
                                    return (
                                        <Wrapper
                                            style={{
                                                paddingBottom: showOptions
                                                    ? "16rem"
                                                    : "1rem",
                                            }}
                                        >
                                            <Form.Select
                                                options={[
                                                    {
                                                        value: "A",
                                                        label: "Option A",
                                                    },
                                                    {
                                                        value: "B",
                                                        label: "Option B",
                                                    },
                                                    {
                                                        value: "C",
                                                        label: "Option C",
                                                    },
                                                    {
                                                        value: "D",
                                                        label: "Option D",
                                                    },
                                                ]}
                                                valueExtractor={(item) =>
                                                    item.value
                                                }
                                                listExtractor={(item) =>
                                                    item.label
                                                }
                                                displayValueExtractor={(item) =>
                                                    item.label
                                                }
                                                onShowOptions={() =>
                                                    setShowOptions(true)
                                                }
                                                onHideOptions={() =>
                                                    setShowOptions(false)
                                                }
                                            />
                                        </Wrapper>
                                    );
                                },
                            },
                        ]}
                    />
                </div>
            );
        }}
    </Story>
</Canvas>
