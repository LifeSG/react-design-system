import { MagnifierIcon } from "@lifesg/react-icons/magnifier";
import { Canvas, Meta, Story } from "@storybook/addon-docs";
import { useState } from "react";
import { Filter } from "../../src/filter";
import { Form } from "../../src/form";
import { Overlay } from "../../src/overlay";
import {
    Heading3,
    Secondary,
    StoryContainer,
    Title,
} from "../storybook-common";
import {
    DateFilter,
    SearchFilter,
    StyledFilterItem,
    TextFilter,
    useFilters,
} from "./doc-elements";
import { PropsTable } from "./props-table";

<Meta title="Modules/Filter" component={Filter} />

<Title>Filter</Title>

<Secondary>Overview</Secondary>

Displays widgets under collapsible panels to filter data results.

```tsx
import { Filter } from "@lifesg/react-design-system/filter";
```

<Canvas>
    <Story name="Filter">
        {() => {
            const {
                currentFilters,
                draftFilters,
                clearButtonDisabled,
                updateFilter,
                saveFilters,
                dismissFilters,
                clearFilters,
            } = useFilters({ search: "", date: undefined }); // your custom filter state management here
            return (
                <StoryContainer>
                    <Filter
                        clearButtonDisabled={clearButtonDisabled}
                        onClear={clearFilters}
                        onDismiss={dismissFilters}
                        onDone={saveFilters}
                    >
                        {(mode) => (
                            <>
                                <StyledFilterItem
                                    $mode={mode}
                                    collapsible={false}
                                    showMobileDivider={false}
                                    showDivider={false}
                                >
                                    <SearchFilter
                                        mode={mode}
                                        value={draftFilters.search}
                                        onChange={updateFilter(mode, "search")}
                                    />
                                </StyledFilterItem>
                                <Filter.Item title="Date">
                                    <DateFilter
                                        mode={mode}
                                        value={draftFilters.date}
                                        onChange={updateFilter(mode, "date")}
                                    />
                                </Filter.Item>
                                <Filter.Item title="Just an example of long content that may wrap to the next line">
                                    <TextFilter />
                                </Filter.Item>
                            </>
                        )}
                    </Filter>
                </StoryContainer>
            );
        }}
    </Story>
</Canvas>

<Heading3>Configuring filter item</Heading3>

Each item can be configured with `collapsible`, `showDivider` and `showMobileDivider` props.

<Canvas>
    <Story name="Configuring filter item">
        <StoryContainer>
            <Filter>
                <Filter.Item
                    title="No divider"
                    showMobileDivider={false}
                    showDivider={false}
                >
                    Without divider
                </Filter.Item>
                <Filter.Item title="With divider">With divider</Filter.Item>
                <Filter.Item title="Default">Collapsible</Filter.Item>
                <Filter.Item>No title, collapsible</Filter.Item>
                <Filter.Item collapsible={false}>
                    No title, not collapsible
                </Filter.Item>
                <Filter.Item title="Not collapsible" collapsible={false}>
                    Always visible
                </Filter.Item>
            </Filter>
        </StoryContainer>
    </Story>
</Canvas>

<Heading3>Minimising content</Heading3>

For longer filter items, content can be minimised with the `minimisable` prop.

<Canvas>
    <Story name="Minimised">
        <StoryContainer>
            <Filter>
                <Filter.Item
                    title="Minimised"
                    minimisable
                    showMobileDivider={false}
                >
                    <TextFilter />
                </Filter.Item>
                <Filter.Item
                    title="With custom minimised height"
                    minimisable
                    minimisedHeight={100}
                >
                    <TextFilter />
                </Filter.Item>
            </Filter>
        </StoryContainer>
    </Story>
</Canvas>

<Heading3>Accessing mode</Heading3>

If you need the current visible mode, you may pass in a render prop as a child of `Filter` or `Filter.Item`.

<Canvas>
    <Story name="Accessing mode">
        <StoryContainer>
            <Filter>
                <Filter.Item title="Mode" showMobileDivider={false}>
                    {(mode) =>
                        mode === "mobile"
                            ? "Mobile view. Switch to a larger viewport to see default view."
                            : "Default view. Switch to a smaller viewport to see mobile view."
                    }
                </Filter.Item>
            </Filter>
        </StoryContainer>
    </Story>
</Canvas>

<Heading3>Floating content</Heading3>

If some child elements are positioned absolutely, content may be clipped if they exceed the parent's boundaries.
For such scenarios, you may increase the height of the container by adding some padding.

In the example below, extra padding is applied when the dropdown list is expanded.

<Canvas>
    <Story name="With floating content">
        {() => {
            const [showOptions, setShowOptions] = useState(false);
            return (
                <StoryContainer>
                    <Filter>
                        <Filter.Item
                            title="Category 1"
                            style={{
                                paddingBottom: showOptions ? "17rem" : "1rem",
                            }}
                            showMobileDivider={false}
                        >
                            <Form.Select
                                options={[
                                    {
                                        value: "A",
                                        label: "Option A",
                                    },
                                    {
                                        value: "B",
                                        label: "Option B",
                                    },
                                    {
                                        value: "C",
                                        label: "Option C",
                                    },
                                    {
                                        value: "D",
                                        label: "Option D",
                                    },
                                ]}
                                valueExtractor={(item) => item.value}
                                listExtractor={(item) => item.label}
                                displayValueExtractor={(item) => item.label}
                                onShowOptions={() => setShowOptions(true)}
                                onHideOptions={() => setShowOptions(false)}
                            />
                        </Filter.Item>
                    </Filter>
                </StoryContainer>
            );
        }}
    </Story>
</Canvas>

<Heading3>Displaying filter in fullscreen</Heading3>

Some filters may need to rendered as a fullscreen page while editing. A display component is provided for this purpose and can be combined with the `Overlay` component.

<Canvas>
    <Story name="Display filter in fullscreen">
        <StoryContainer
            style={{
                height: "80vh",
                border: "1px solid grey",
            }}
        >
            <Filter.Page>
                <div style={{ margin: "1rem" }}>Custom content</div>
            </Filter.Page>
        </StoryContainer>
    </Story>
</Canvas>

<PropsTable />
